\# BEGIN MACRO SECTION
\#
\#
\######## IMAGE METADATA ###########
.de image_access
\fB{-a|--unauthenticated_access}\fP {\fBtrue\fP|\fBfalse\fP}
-\ Defaults to false. If set to true, the image may be retrieved by anybody who has the correct URL.
..
.de image_description
\fB{-d|--description}\fP \fIvalue\fP
-\ Description of the image.
..
.de image_file
\fB{-f|--file}\fP \fIpath\fP
\- 
..
.de image_hypervisor
\fB{-h|--hypervisor}\fP \fIvalue\fP
\- The hypervisor. Ex: xen, kvm, etc.
..
.de image_new_name
\fB{-n|--new_name}\fP \fIvalue\fP
\- The new name of the image-slot on the repository. This will be used to reference the image when running
other repoman commands. It must be unique to the owner's domain and can only contain ([a-Z][0-9][_][-]) characters.
..
.de image_owner
\fB{-o|--owner}\fP \fIuser\fP
\- The owner of the named image. The default is the ID of the current repoman user which can be determined with the command "\fBrepoman whoami\fP" command. 
..
.de image_os_arch
\fB--os_arch\fP \fIvalue\fP
-\ The operating system architecture. x86 or x86_64
..
.de image_os_type
\fB--os_type\fP \fIvalue\fP
-\ The operating system type. Ex: linux, unix, windows, etc.
..
.de image_os_variant
\fB--os_variant\fP \fIvalue\fP
-\ The operating system variant. Ex: redhat, centos, ubuntu, etc.
..
.de image_path
\fB{-p|--path} \fP\fIpath\fP
\- The destination of the downloaded image.
If omitted, the image is downloaded to a file with the same name as the image into your current working directory.
..
.de image_image
\fIimage\fP
\- 
..

\######## USER METADATA ###########
.de user_client_dn
\fB{-c|--client_dn}\fP \fIdn\fP \- The Distinguished Name (DN) of the certificate which is owned by the user.
..
.de user_email
\fB{-e|--email}\fP \fIaddress\fP \- The email address of the user.
..
.de user_full_name
\fB{-f|--full_name}\fP \fIname\fP \- The full name of the user.
..
.de user_new_name
\fB{-n|--new_name}\fP \fIuser\fP \- The new unique username for the user.
..
\######## GROUP METADATA #########
.de group_new_name
\fB{-n|--new_name}\fP \fIvalue\fP
\- The name of the group. It must be unique and can only contain ([a-Z][0-9][_][-]) characters.
..
.de group_permissions
\fB{-p|--permissions}\fP \fIlist\fP
\- The permissions that the members of the group have (Blank separated list Ex: \fB\'user_delete image_modify\'\fP). Possible values are: \fBgroup_create, group_delete, group_modify, group_modify_membership, group_modify_permissions, image_create, image_delete, image_delete_group, image_modify, image_modify_group, user_create, user_delete, user_modify, user_modify_self\fP. See GROUP PERMISSIONS section for a description of each permission.
..
.de group_users
\fB{-u|--users\fP \fIlist}\fP
-\ The users that are members of the group. (Blank separated list) Ex: \'msmith sjobs\'
..
\#
\#
\#
\# END MACRO SECTION
.TH REPOMAN 1 "28 November 2011"
.SH NAME
repoman \- a command to interact with repoman Virtual Machine (VM) image repositories
.SH SYNOPSIS

\fBrepoman\fP help [\fIsubcommand\fP]

\fBrepoman\fP [options] \fIsubcommand\fP

.SH DESCRIPTION
Repoman is the name given to both a user command and a server software package that provides Virtual Machine (VM) image
repository management over the web (HTTP/HTTPS). This man page describes the command used to interact with a repoman server,
allowing you to create, manage, and delete Virtual Machine images.
.SS Options
.TP
\fB{-r|--repository}\fP \fIfully_qualified_host_name\fP
Override the configuration file default \fIrepository\fP setting with \fIfully_qualified_host_name\fP.
For example: "vmrepo.example.ca".
.TP
\fB{-p|--port}\fP \fIport\fP
Override the configuration file default \fIport\fP setting with \fIport\fP.
Defaults to 443, the default port for a repoman server.
.TP
\fB{-P|--proxy}\fP \fIpath\fP
Override the configuration file default proxy certificate path with \fIpath\fP.
Defaults to "/tmp/x509up_uNNNN", where "NNNN" is your effective UID.
.TP
\fIsubcommand\fP
See the following sections for possible subcommands and subcommand parameters.

.SH HELP SUBCOMMAND
.TP
\fBhelp\fP [\fIsubcommand\fP]
Show the help dialog. If no subcommand is specified, a general overview of all subcommands is displayed.
Specifying a subcommand displays information specific to that subcommand.

.SH CONFIGURATION SUBCOMMAND
Before other repoman subcommands can be used, a configuration file must be created. The following subcommand will create the
configuration file for you.
.TP
\fB{mc|make-config}\fP [{-E|--system-excludes} \fIsystem_paths\fP] [{-e|--user-excludes} \fIuser_paths\fP]
.TP
{-E|--system-excludes} \fIsystem_paths\fP
Blank separated list of paths to be excluded from a snapshot of the
operating system during a \fBrepoman save-image\fP. A directory path specification ending in \'/*\' will cause the directory
to be created in the saved image, but none of it's contents to be copied to the saved image.
Defaults to \'/cvmfs/* /dev/* /mnt/* /proc/* /root/.ssh /sys/* /tmp/*\'.
See note under \fBuser-excludes\fP.
.TP
{-e|--user-excludes} \fIuser_paths\fP
Blank separated list of paths to be excluded from a snapshot of the
operating system during a \fBrepoman save-image\fP. A directory path specification ending in \'/*\' will cause the directory
to be created in the saved image, but none of it's contents to be copied to the saved image.
Defaults to an empty list.
\fBNote:\fP The \fBsystem-excludes\fP and \fBuser-excludes\fP parameters perform precisely the same function. However, because certain specifications
are required to create a functional image, these specifications are established by default in the \fBsystem-excludes\fP parameter. It is recommended
that other exclusions be made by modifying the \fBuser-excludes\fP parameter only.

.SH IMAGE MANIPULATION SUBCOMMANDS
A VM image is a file containing a bootable copy of a configured operating system.
In a repoman VM repository, an image is identified by the owning user and a name unique within the owner's domain.
In addition to the image itself, the repoman repository maintains \'metadata\' or information about the image (for example: name, description, architecture, etc.) in an image-slot within a database.

.TP
\fB{ci|create-image}\fP \fIimage\fP [{-a|--unauthenticated_access} {\fItrue\fP|\fIfalse\fP}] [{-d|--description} \fIvalue\fP] [{-f|--file} \fIfile\fP] [--hypervisor \fIvalue\fP] [{-o|--owner} \fIuser\fP] [--os_variant \fIvalue\fP] [--os_arch \fIvalue\fP] [--os_type \fIvalue\fP]
Create a new repoman image-slot based on the given information.
If an image file is supplied, then \fIfile\fP is uploaded to the repoman repository after the entry is created.

.image_image
The name of the newly created image-slot on the repository.
This will be used to reference the image when running other repoman commands.
It must be unique within the owner's domain and can only contain ([a-Z][0-9][_][-]) characters.

.image_access

.image_description

.image_file
The path to the image file that will be uploaded to the repository.

.image_hypervisor

.image_owner

.image_os_arch

.image_os_type

.image_os_variant

.TP
\fB{di|describe-image}\fP \fIimage\fP [{-o|--owner} \fIuser\fP]
Display all information about an image.

.image_image
The image to describe. Use \fBrepoman list-images\fP to see possible values.

.image_owner

.TP
\fB{gi|get-image}\fP \fIimage\fP [{-o|--owner} \fIuser\fP] [{-p|--path} \fIpath\fP]
Download an image from the repository to the specified path.

.image_image
The image to download. Use \fBrepoman list-images\fP to see possible values.

.image_owner

.image_path

.TP
\fB{li|list-images}\fP [-a|--all] [{-g|--group} \fIgroup\fP] [-l|--long] [{-s|--sharedwith}] [-U|--url] [{-u|--user} \fIuser\fP]]
List images stored in the repository.

\fB{-a|--all}\fP \- Display the names of all the images on the repository.

\fB{-g|--group}\fP \fIgroup\fP \- Only list images accessible by members of the group \fIgroup\fP.
See examples below.

\fB{-l|--long}\fP \- Display a table with extra information. Example:
.TS
tab(~);
l l l l l.
Image Name~Owner~Size~Last Modified~Description
=
myImage~jdoe~4.2GB~Dec 6, 16:04:54 2011~My new image
.TE

\fB{-s|--sharedwith}\fP \- Modifier flag. See below examples.

\fB{-U|--url}\fP \- In addition to the name, display the HTTP and HTTPS URLs of each image. Example:
.TS
tab(~);
l
ls.
myImage
  http://vmrepo.example.ca/api/images/raw/jdoe/myImage~
  https://vmrepo.example.ca:443/api/images/raw/jdoe/myImage~
.TE

\fB{-u|--user}\fP \fIuser\fP \- List images either owned by \fIuser\fP or your images shared with \fIuser\fP.
See examples below.

Examples:

    \fBrepoman list-images\fP
        \- list the current user's images
    \fBrepoman list-images --sharedwith\fP
        \- list the images shared with the current user
    \fBrepoman list-images --user bob\fP
        \- list images owned by the user \'bob\'
    \fBrepoman list-images --sharedwith --user bob\fP
        \- list the images shared with the user \'bob\'
    \fBrepoman list-images --group babar\fP
        \- list images accessible by members of the \'babar\' group
    \fBrepoman list-images --sharedwith --group babar\fP
        \- has the same effect as the previous example

.TP
\fB{mi|modify-image}\fP \fIimage\fP [{-a|--unauthenticated_access} {\fItrue\fP|\fIfalse\fP}] [{-d|--description} \fIvalue\fP] [--hypervisor \fIvalue\fP] [{-n|--new_name} \fIvalue\fP] [{-o|--owner} \fIuser\fP] [--os_variant \fIvalue\fP] [--os_arch \fIvalue\fP] [--os_type \fIvalue\fP]
Modify an image with the given information.

.image_image
The name of the image to modify. Use repoman list-images to see possible values.

.image_access

.image_description

.image_hypervisor

.image_new_name

.image_owner

.image_os_arch

.image_os_type

.image_os_variant

Example:

\fBrepoman modify-image myImage --new_name myNewImage --description \'This is an example of a rename image\'\fP
    - renames myImage to myNewImage and updates the description 

.TP
\fB{pi|put-image}\fP \fIfile\fP \fIimage\fP [{-o|--owner} \fIuser\fP]
Upload an image file from local disk space to the repoman repository and associate it with an existing image-slot.

\fIfile\fP \- The local image file to upload to the repository.

.image_image
The name of the image slot to be used. Use \fBrepoman list-images\fP to see possible values. 

.image_owner

.TP
\fB{ri|remove-image}\fP \fIimage\fP [{-f|--force}] [{-o|--owner} \fIuser\fP]
Delete the specified image from the repository.

.image_image
The name of the image to be deleted.

\fB{-f|--force}\fP \- Delete image without confirmation.

.image_owner

.TP
\fB{si|save-image}\fP \fIimage\fP [{-a|--unauthenticated_access} {true|false}] [--clean] [{-d|--description} \fIvalue\fP] [{-f|--force}] [--gzip] [{-h|--hypervisor \fIvalue\fP}] [{-o|--owner} \fIuser\fP] [--os_variant \fIvalue\fP] [--os_arch \fIvalue\fP] [--os_type \fIvalue\fP] [--resize \fISIZE\fP] [--verbose]
Takes a snapshot of your running system's filesystem (except pats listed under \fIsystem-excludes\fP and \fI user-excludes\fP in repoman configuration file).
If \fIname\fP is not in your user's domain, an image-slot entry is created with the supplied metadata information.
If \fIname\fP does exist, the image-slot is updated with any given metadata.
Finally, the snapshot is uploaded to the image-slot on the repoman repository.

.image_image
The name of the newly created or existing image-slot on the repository.
This will be used to reference the image when running other repoman commands.
It can only contain ([a-Z][0-9][_][-]) characters.

.image_access

\fB--clean\fP \- Remove any existing local snapshots before creating a new one.

.image_description

\fB{-f|--force}\fP \- Force uploading even if it overwrites an existing image.

\fB--gzip\fP \- Upload the image compressed with gzip.

.image_hypervisor

.image_owner

.image_os_arch

.image_os_type

.image_os_variant

\fB--resize\fP \fISIZE\fP \- Create an image with a size of \fISIZE\fP MB.
The size selected must be big enough to contain the entire filesystem image.
If the size specified is not big enough, repoman will issue an error mesage and exit.

\fB--verbose\fP \- Display verbose output during snapshot.

.TP
\fB{sig|share-image-with-groups}\fP \fIimage\fP \fIgroup\fP [\fIgroup\fP ...] [{-o|--owner} \fIuser\fP]
Share an image with one or more groups.

\fIimage\fP \- The image to share. Use \fBrepoman list-images\fP to see possible values.

\fIgroup\fP \- The name of the group(s) to share the image with. Use \fBrepoman list-groups\fP to see possible values.

.image_owner

.TP
\fB{siu|share-image-with-users}\fP \fIimage\fP \fIuser\fP [\fIuser\fP ...] [{-o|--owner} \fIuser\fP]
Share an image with one or more users.

\fIimage\fP \- The image to share. Use \fBrepoman list-images\fP to see possible values.

\fIuser\fP \- The name of the users(s) to share the image with. Use \fBrepoman list-users\fP to see possible values.

.image_owner

.TP
\fB{uig|unshare-image-with-groups}\fP \fIimage\fP \fIgroup\fP [\fIgroup\fP ...] [{-o|--owner} \fIuser\fP]
Unshare an image with one or more groups.

\fIimage\fP \- The image to unshare. Use \fBrepoman list-images\fP to see possible values.

\fIgroup\fP \- The name of the group(s) to unshare the image with. Use \fBrepoman describe-image\fP to see possible values.

.image_owner

.TP
\fB{uiu|unshare-image-with-users}\fP \fIimage\fP \fIuser\fP [\fIuser\fP ...] [{-o|--owner} \fIuser\fP]
Unshare an image with one or more users.

\fIimage\fP \- The image to unshare. Use \fBrepoman list-images\fP to see possible values.

\fIuser\fP \- The name of the users(s) to unshare the image with. Use \fBrepoman describe-image\fP to see possible values.

.image_owner

.SH USER MANIPULATION SUBCOMMANDS
Each user of a repoman image repository must be registered.
The repoman user ID is associated with a user's x509 credentials and is used to uniquely identify images within the repository.

.TP
\fB{cu|create-user}\fP \fIuser\fP \fIclient_dn\fP [{-e|--email} \fIaddress\fP] [{-f|--full_name} \fIname\fP]
Create a new repoman user based on given information.

\fIuser\fP \- The name of the newly created user. Must be unique and only contain characters ([a-Z][0-9][_][-]).

\fIclient_dn\fP \- The Distinguished Name (DN, looks like: \fB\'/C=CA/O=Grid/OU=dept.org.ca/CN=John Doe\'\fP) of the certificate owned by the user and issued by a certificate authority, for example GridCanada.ca.

.user_email

.user_full_name

.TP
\fB{du|describe-user}\fP \fIuser\fP
Display information about a repoman user.

\fIuser\fP \- The user to describe. Use \fBrepoman list-users\fP to see possible values.

.TP
\fB{lu|list-users}\fP [{-g|--group} \fIgroup\fP] [{-l|--long}]
List repoman users.

\fB{-g|--group}\fP \fIgroup\fP \- Only display users the belong to the group \fIgroup\fP

\fB{-l|--long}\fP \- Display a table with extra information. Example:
.TS
tab(~);
l l l l l.
Username~Full Name~Client DN
=
jdoe~John Doe~/C=CA/O=Grid/OU=dept.org.ca/CN=John Doe
.TE

.TP
\fB{mu|modify-user}\fP \fIuser\fP [{-c|--client_dn} \fIdn\fP] [{-e|--email} \fIaddress\fP] [{-f|--full_name} \fIname\fP] [{-n|--new_name} \fIname\fP]
Modify a repoman user with the given metadata information.

\fIuser\fP - The name of the user to be modified. See \fBrepoman list-users\fP to see possible values.

.user_client_dn

.user_email

.user_full_name

.user_new_name

Example:

\fBrepoman modify-user jdoe --new_name johndoe --email johndoe@uvic.ca\fP
    - renames a repoman user and updates their email address.

.TP
\fB{ru|remove-user}\fP \fIuser\fP [{-f|--force}]
Remove a repoman user. \fBNote:\fP All images owned by \fIuser\fP will be deleted.

\fIuser\fP \- The user to delete. Use \fBrepoman list-users\fP to see possible values.

\fB{-f|--force}\fP \- Delete user without confirmation.

.SH GROUP MANIPULATION SUBCOMMANDS
Repoman facilitates the concept of user groups for the purpose of sharing images. The following section details
subcommands to create, maintain, and destroy user groups.

.TP
\fB{apg|add-permissions-to-group}\fP \fIgroup\fP \fIpermission\fP [\fIpermission\fP ...]
Add specified permissions to a group.

\fIgroup\fP \- The group that you are adding permissions to. Use \fBrepoman list-groups\fP to see possible values.

\fIpermission\fP -\ The permission(s) to add to the group. Possible values are: \fBgroup_create, group_delete, group_modify, group_modify_membership, group_modify_permissions, image_create, image_delete, image_delete_group, image_modify, image_modify_group, user_create, user_delete, user_modify, user_modify_self\fP. See GROUP PERMISSIONS section for a description of each permission.

.TP
\fB{aug|add-users-to-group}\fP \fIgroup\fP \fIuser\fP [\fIuser\fP ...]
Add specified users to a group.

\fIgroup\fP \- The group to add the specified user(s) to.

\fIuser\fP \- The user(s) to add to the group.

\# xxx
.TP
\fB{cg|create-group}\fP \fIgroup\fP [{-p|--permissions} \fIlist\fP] [{-u|--users} \fIlist\fP]
Create a new group based on given information.

\fIgroup\fP \- The name of the newly created group. It must be unique and can only contain ([a-Z][0-9][_][-]) characters.

.group_permissions

.group_users

.TP
\fB{dg|describe-group}\fP \fIgroup\fP
Display information about a group.

\fIgroup\fP \- The group to describe. Use \fBrepoman list-groups\fP to see possible values.

.TP
\fB{lg|list-groups}\fP [{-a|--all}] [{-l|--long}] [{-u|--user} \fIuser\fP]
List user groups on the repoman repository that you belong to.

\fB{-a|--all}\fP \- Display all groups.

\fB{-l|--long}\fP \- Display extra information in a table. Example:
.TS
tab(~);
l l l l l.
Group Name~Members
=
mygroup~jdoe,hsimpson,pgriffin
.TE

\fB{-u|--user}\fP \fIuser\fP \- Display group membership for the user \fIuser\fP.

.TP
\fB{mg|modify-group}\fP \fIgroup\fP [{-n|--new_name} \fIvalue\fP] [{-p|--permissions} \fIlist\fP] [{-u|--users} \fIlist\fP]
Modify a group with the given information.

\fIgroup\fP - The group you want to modify. Use \fBrepoman list-groups\fP to see possible values.

.group_new_name

.group_permissions

.group_users

Example:

\fBrepoman modify-group mygroup --new_name mynewgroup --permissions \'user_modify_self image_create\'\fP
    - renames a repoman group and sets some basic permissions

.TP
\fB{rg|remove-group}\fP \fIgroup\fP [{-f|--force}]
Remove a group from the repoman repository.

\fIgroup\fP \- The group to delete.

\fB{-f|--force}\fP \- Delete group without confirmation.

.TP
\fB{rpg|remove-permissions-from-group}\fP \fIgroup\fP \fIpermission\fP [\fIpermission\fP ...]
Remove specified permission(s) from a group.

\fIgroup\fP \- The group that you are removing permissions from. Use \fBrepoman list-groups\fP to see possible values.

\fIpermission\fP -\ The permission(s) to remove from the group. Possible values are: \fBgroup_create, group_delete, group_modify, group_modify_membership, group_modify_permissions, image_create, image_delete, image_delete_group, image_modify, image_modify_group, user_create, user_delete, user_modify, user_modify_self\fP. See GROUP PERMISSIONS for a description of each permission.

.TP
\fB{rug|remove-users-from-group}\fP \fIgroup\fP \fIuser\fP [\fIuser\fP ...]
Remove specified users from a group.

\fIgroup\fP \- The group to remove the specified user(s) from.

\fIuser\fP \- The user(s) to remove from the group.

.SH MISCELLANEOUS SUBCOMMANDS
.TP
\fBabout\fP
Display the repoman client version and configuration information.

.TP
\fBversion\fP
Display the repoman client version information.

.TP
\fBwhoami\fP
Display information about the current user (ie, you)

.SH GROUP PERMISSIONS  \fBNOTE: Andre C to verify\fP
.TP
\fBgroup_create\fP
The ability to create new groups.
.TP
\fBgroup_delete\fP
The ability to delete groups.
.TP
\fBgroup_modify\fP
The ability to modify any\fB???\fP of the group's attributes.
.TP
\fBgroup_modify_membership\fP
The ability to modify a group's user list.
.TP
\fBgroup_modify_permissions\fP
The ability to modify a group's permissions list.
.TP
\fBimage_create\fP
The ability to create images.
.TP
\fBimage delete.\fP
The ability to delete images owned by you.
.TP
\fBimage_delete_group\fP
The ability to delete images that belong to any member of your group.
.TP
\fBimage_modify\fP
The ability to modify images owned by you.
.TP
\fBimage_modify_group\fP
The ability to modify images that belong to any member of your group.
.TP
\fBuser_create\fP
The ability to create new users.
.TP
\fBuser_delete\fP
The ability to delete users.
.TP
\fBuser_modify\fP
The ability to modify any\fB???\fP of a user's attributes.
.TP
\fBuser_modify_self\fP
The ability to modify your own attributes.

.SH FILES
.TP
~/.repoman/repoman.conf
This is a per-user configuration file. It can be created and maintained manually with your favorite text editor, or
via use of the \fBmake-config\fP subcommand.

.SH AUTHORS
Andre Charbonneau

Andrey Polyakov

Colin Leavett-Brown

Drew Harris

Ian Gable

Matt Vliet

Patrick Armstrong

Tubego Phamphang
.SH BUGS
If you have any issues or ideas for improving Repoman, please use the github issue tracker to allow others to follow along with problems and ideas. The issue tracker can be found at: 

https://github.com/hep-gc/repoman/issues
